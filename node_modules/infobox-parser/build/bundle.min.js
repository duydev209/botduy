"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}function trimWrappers(t){return t.replace(/\[\[/g,"").replace(/\]\]/g,"").replace(/\{\{/g,"").replace(/\}\}/g,"").trim()}function trimOr(t){var e=t.indexOf("|");return-1!==e?t.substring(0,e):t}function getValue(t,e){if(!t)return null;var r=t.trim().replace(/File:/,"").replace(/\{\{\d+\}\}/g,"").replace(extraPropertyPattern,"").replace(endingPattern,"");if("y"===r||"yes"===r)return!0;if("birthPlace"==e)return t.trim();var a=r.match(linksPattern);return a?a[0].split(linkSeparatorPattern).filter(function(t){return t}):trimOr(trimWrappers(r))}function dataType(t){var e=t.globalPattern,r=t.parsePattern,a=t.parse,n=t.variable,l=t.name;return function(t){var i=t.match(e);if(!i){var s;return s={},defineProperty(s,l,[]),defineProperty(s,"sourceAfter",t),s}var o=i.map(function(t){return a(t.match(r))}),u=i.reduce(function(t,e,r){return o[r]===DO_NOT_REPLACE?t:t.replace(e,"$"+n+"_"+r)},t);return{data:defineProperty({},l,o),sourceAfter:u}}}function byDataHandler(t,e){var r=t.source,a=t.context,n=e(r),l=n.data,i=n.sourceAfter;return{context:Object.assign({},a,l),source:i}}function extractData(t){return dataTypes$1.map(function(t){return t.handler}).reduce(byDataHandler,{context:{},source:t})}function findPropertyList(t){var e=t.match(keyValueGlobalPattern);return e?e.map(function(t){var e=keyValuePattern.exec(t);if(!e)return null;var r=slicedToArray(e,3),a=r[1],n=r[2],l=camelCase(a.trim());return{key:l,value:getValue(n,l)}}).filter(function(t){return t}):[]}function fillVariable(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r.simplifyDataValues;if("string"!=typeof t)return console.log("Warning: Something went wrong. Could not fill variables in: ("+(void 0===t?"undefined":_typeof(t))+") "+JSON.stringify(t)),{};var n=dataTypes$1.find(function(e){return t.match(e.pattern)});if(n){var l=n.pattern.exec(t),i=slicedToArray(l,2),s=i[0],o=i[1],u=e[n.name][parseInt(o,10)];return a||"string"!=typeof u?u:t.replace(s,u)}return t}function fillVariables(t,e,r){if(void 0===t)return t;if(t instanceof Date)return t;if("number"==typeof t)return t;if(Array.isArray(t))return t.map(function(t){return fillVariables(t,e,r)});if("object"===(void 0===t?"undefined":_typeof(t)))return Object.keys(t).reduce(function(a,n){return Object.assign(a,defineProperty({},n,fillVariables(t[n],e,r)))},{});var a=fillVariable(t,e,r);return a===t?t:fillVariables(a,e,r)}function handleSmallData(t,e,r){var a=r.simplifyDataValues;if("string"==typeof t&&t.match(smallDataType.pattern)){var n=t.replace(smallDataType.pattern,"").replace(/,/,"").trim(),l=smallDataType.pattern.exec(t),i=slicedToArray(l,2),s=i[1],o=e[smallDataType.name][parseInt(s,10)],u={primary:getVariableValue(n,e,{simplifyDataValues:a}),secondary:getVariableValue(o,e,{simplifyDataValues:a})};return a?u.primary:u}return null}function getVariableValue(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r.simplifyDataValues,n=handleSmallData(t,e,{simplifyDataValues:a});return n||fillVariables(t,e,{simplifyDataValues:a})}function reduceVariable(t,e,r,a){if(null===e)return null;if("boolean"==typeof e)return e;if(Array.isArray(e))return e.map(function(t){return getVariableValue(t,r,a)});if(t.match(/areaTotal/)||t.match(/population/)){var n=numberParse(e);if(!1===n&&(n=parseFloat(e,10)),!isNaN(n))return n}if(t.match(/date/i)){var l=+new Date(e);if(!isNaN(l))return new Date(e)}var i=getVariableValue(e,r,a);return Array.isArray(i)?i.map(function(t){return getVariableValue(t,r,a)}):i}function byVariableReduction(t,e){return function(r,a){var n=a.key,l=a.value,i=reduceVariable(n,l,t,e);return""===i||null===i?r:Object.assign({},r,defineProperty({},n,i))}}function extractProperties(t){var e=t.source,r=t.context,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.simplifyDataValues,l=void 0===n||n;return findPropertyList(e).reduce(byVariableReduction(r,{simplifyDataValues:l}),{})}function transformProperties(t){return Object.keys(t).reduce(function(e,r){var a=t[r],n=r.match(blankNamePattern);if(n){var l=n[1]||"",i=t["blank"+l+"NameSec2"],s=t["blank"+l+"InfoSec2"];return"string"!=typeof i?e:Object.assign(e,defineProperty({},camelCase(i),s))}return r.match(blankInfoPattern)?e:Object.assign(e,defineProperty({},r,a))},{})}function findOuterIndex(t){for(var e=[],r=0;r<t.length-1;r++){var a=t.substr(r,2);if("{{"!==a){if("}}"===a){e.pop();if(0===e.length)return r+2;r++}}else e.push(r),r++}}function parse(t){var e=t.match(infoBoxStartPattern);if(!e)return{data:t,sourceLeft:null};var r=e.index,a=t.substring(r),n=findOuterIndex(a);if(!n)return{data:t,sourceLeft:null};var l=a.substring(0,n),i=t.substring(n);return{data:l,sourceLeft:!i.match(infoBoxStartPattern)?null:i}}function extractInfoboxes(t){for(var e=parse(t),r=[e.data];e.sourceLeft;)e=parse(e.sourceLeft),r.push(e.data);return r}function cleanSource(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.removeSmall,a=void 0!==r&&r,n=e.removeReferences;return(void 0===n||n)&&(t=t.replace(/<ref(\s\w+=[^>]+)?>.*<\/ref>/g,"").replace(/<ref(\s\w+=[^>]+)?\s?\/>/g,"")),a&&(t=t.replace(/<small>.*<\/small>/g,"")),t.replace(/'''?/g,"").replace(/\|display=inline/g,"").replace(/<br\s?\/?>/g,",").replace(/&minus;/g,"-").replace(/<sup>/g,"^").replace(/\{\{sfn\|([^\}\}]+)\}\}/g,"").replace(/\{\{efn\|([^\}\}]+)\}\}/g,"").replace(/âˆ’/g,"-").replace(/<\/sup>/g,"").replace(/\{\{\s*nowrap\s*\|([^\n\}]+)\}\}/gi,"$1").replace(/<!--([\s\S]*?)-->/g,"").replace(/&nbsp;/g," ").replace("|''See list''","")}function transformRowSpan(t){return t.map(transformCells).reduce(function(t,e,r){for(var a=0===r?0:1,n=0;n<e.length;n++)t[n+a]||(t[n+a]={}),e[n]&&(t[n+a][e[n]]=1);return t},[]).map(function(t){return Object.keys(t).join(",")}).join(" || ")}function clean(t){return t.substring(2,t.length-2).replace(linkPattern$1,function(t,e){return e.split("|")[0]}).replace(/'''?/g,"")}function parseRow(t){var e=t[0].match(/BS(\d)/),r=t[0].substring(2),a=1,n=[],l=1;for(e&&(a=e[1],r=t[0].substring(3));l<=a;l++)n.push(t[l]);return{type:r,margin:t[l++],text1:t[l++],text2:t[l++],comment:t[l++],icons:n}}function getMatches(t,e){for(var r=void 0,a=[];null!==(r=e.exec(t));)a.push({value:r[1]&&r[1].trim(),start:r.index,end:r.index+r[0].length});return a}function parseTableData(t){var e=t.match(rowPattern$1);return e?e.map(function(t){var e=t.match(rowPatternSingle);return slicedToArray(e,2)[1].trim().split("|").slice(1)}):[]}function getTables(t){var e=getMatches(t,tableStartPattern$1),r=getMatches(t,tableEndPattern$1);return e.map(function(e,a){var n=r[a];if(!n)throw new Error("[Table Parsing] Failed to pair table");return{rows:parseTableData(t.substring(e.end,n.start).trim().replace(/'''/g,"")),start:e.start,end:n.end}})}function last(t){return t.length?t[t.length-1]:void 0}function parseInfobox(t,e){var r=extractInfoboxes(t).map(function(t){return transformProperties(extractProperties(extractData(cleanSource(t,e)),e))});if(!r.length)return{};var a={general:r.shift()};return r.forEach(function(t){var e=t.type;e?a[camelCase(e)]=t:Object.assign(a,{general:Object.assign({},a.general,t)})}),a.tables=parseTables(t),a.bsTables=parseBsTables(t),a.lists=parseLists(t),a}var camelCase=_interopDefault(require("camelcase")),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},defineProperty=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t},slicedToArray=function(){function t(t,e){var r=[],a=!0,n=!1,l=void 0;try{for(var i,s=t[Symbol.iterator]();!(a=(i=s.next()).done)&&(r.push(i.value),!e||r.length!==e);a=!0);}catch(t){n=!0,l=t}finally{try{!a&&s.return&&s.return()}finally{if(n)throw l}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},smallGlobalPattern=/\{\{small\|([^\}\}]+)\}\}/g,smallPattern=/small\|([^\}\}]+)\}\}/,small={globalPattern:smallGlobalPattern,parsePattern:smallPattern,parse:function(t){return slicedToArray(t,2)[1]},variable:"SMALL",name:"smalls"},flagGlobalPattern=/\{\{flag\|([^\}\}]+)\}\}/g,flagPattern=/flag\|([^\}\}]+)\}\}/,flag={globalPattern:flagGlobalPattern,parsePattern:flagPattern,parse:function(t){return slicedToArray(t,2)[1]},variable:"FLAG",name:"flags"},coordsGlobalPattern=/\{\{coord\|([^\}\}]+)\}\}/g,coordsPattern=/coord\|([^\}\}]+)\}\}/,coords={globalPattern:coordsGlobalPattern,parsePattern:coordsPattern,parse:function(t){return slicedToArray(t,2)[1]},variable:"COORD",name:"coords"},globalPattern=/\[\[([^\]\|]+)\|?([^\]]+)?\]\]/g,pattern=/\[\[([^\]\|]+)\|?([^\]]+)?\]\]/,instances={globalPattern:globalPattern,parsePattern:pattern,parse:function(t){var e=slicedToArray(t,3),r=e[1],a=e[2];return r||a},variable:"INSTANCE",name:"instances"},extraPropertyPattern=/\n?\s?\|\s?\w+$/,endingPattern=/\n\}\}$/,linksPattern=/((\$\w+_\d+)\s*,?\s*){2,}/g,linkSeparatorPattern=/[,\s?]/g,listItemPrefixPattern=/^\|\s?/,unbulletedListGlobalPattern=/\{\{(?:unbulleted list|ubl|ubt|ublist|unbullet)\s?\|([^\}\}]+)\}\}/gi,unbulletedListItemPattern=/\|\s*([^|}]+)/g,unbulletedLists={globalPattern:unbulletedListGlobalPattern,parsePattern:unbulletedListItemPattern,parse:function(t){return t?t.map(function(t){return t.replace(listItemPrefixPattern,"").trim()}).filter(function(t){return t&&t.length}):[]},variable:"UNBULLETED_LIST",name:"unbulletedLists"},listItemPrefixPattern$1=/^\*\s*/,plainListGlobalPattern=/\n(\*\s*[^*|]+)+/g,plainListItemPattern=/\*\s*([^*|]+)/g,unmarkedLists={globalPattern:plainListGlobalPattern,parsePattern:plainListItemPattern,parse:function(t){return t?t.map(function(t){return t.replace(listItemPrefixPattern$1,"").trim()}).filter(function(t){return t&&t.length}):[]},variable:"UNMARKED_LIST",name:"unmarkedLists"},listItemPrefixPattern$2=/^\*\s?/,plainListGlobalPattern$1=/\{\{f?p?P?l?a?i?n?t?\s?list\s?\|([^\}\}]+)\}\}/g,plainListItemPattern$1=/\*\s*([^*}]+)/g,plainLists={globalPattern:plainListGlobalPattern$1,parsePattern:plainListItemPattern$1,parse:function(t){return t?t.map(function(t){return t.replace(listItemPrefixPattern$2,"").trim()}).filter(function(t){return t&&t.length}):[]},variable:"PLAIN_LIST",name:"plainLists"},marriageGlobalPattern=/\{\{Marriage\|([^\}\}]+)\}\}/gi,marriagePattern=/Marriage\|([^|]+)\|(.*)\}\}/i,marriages={globalPattern:marriageGlobalPattern,parsePattern:marriagePattern,parse:function(t){var e=slicedToArray(t,3);return{who:e[1],married:e[2]}},variable:"MARRIAGE",name:"marriages"},nbayGlobalPattern=/\{\{nbay\|([^\}\}]+)\}\}/gi,nbayPattern=/nbay\|([^|]+)\|(.*)\}\}/i,nbay={globalPattern:nbayGlobalPattern,parsePattern:nbayPattern,parse:function(t){var e=slicedToArray(t,3),r=e[1];e[2];return r},variable:"nbay",name:"nbay"},otherGlobalPattern=/\{\{([^|\n]+)\|([^|\n]+)\|?([^\}\n]+)?\}\}/g,otherPattern=/\{\{([^|\n]+)\|([^|\n]+)\|?([^\}\n]+)?\}\}/,other={globalPattern:otherGlobalPattern,parsePattern:otherPattern,parse:function(t){var e=slicedToArray(t,4),r=e[1];e[2],e[3];return r},variable:"OTHER",name:"others"},hlistGlobalPattern=/\{\{hlist\|([^\}\}]+)\}\}/gi,hlistPattern=/hlist\|(.*)\n?\}\}/i,hlist={globalPattern:hlistGlobalPattern,parsePattern:hlistPattern,parse:function(t){return slicedToArray(t,2)[1].split("|")},variable:"HLIST",name:"hlists"},birthDateGlobalPattern=/\{\{birth\sdate([^\}\}]+)\}\}/gi,birthDatePattern=/(\d+)\|(\d+)\|(\d+)/,millisInYear=31536e6,birthDates={globalPattern:birthDateGlobalPattern,parsePattern:birthDatePattern,parse:function(t){var e=slicedToArray(t,4),r=e[1],a=e[2],n=e[3],l=new Date(r,a-1,n);return{date:l,age:Math.floor((Date.now()-+l)/millisInYear)}},variable:"BIRTH_DATE",name:"birthDates"},DO_NOT_REPLACE=Symbol("DO NOT REPLACE"),labeledDateGlobalPattern=/\{\{([^\n\}\}]+)\}\}/g,labeledDatePattern=/(.*)/,labeledDates={globalPattern:labeledDateGlobalPattern,parsePattern:labeledDatePattern,parse:function(t){var e=t[0].indexOf("|");if(e>-1){var r=t[0].substring(e+1).slice(0,-2),a=new Date(r+" GMT");if(!isNaN(a.getTime()))return{date:a};if(a=new Date(r.split("|").join("-")+" GMT"),!isNaN(a.getTime()))return{date:a}}return DO_NOT_REPLACE},variable:"LABELED_DATE",name:"labeledDates"},deathDateGlobalPattern=/\{\{death\sdate\sand\sage([^\}\}]+)\}\}/gi,deathDatePattern=/(\d+)\|(\d+)\|(\d+)\|(\d+)\|?(\d+)?\|?(\d+)?/,millisInYear$1=31536e6,deathDates={globalPattern:deathDateGlobalPattern,parsePattern:deathDatePattern,parse:function(t){var e=slicedToArray(t,7),r=e[1],a=e[2],n=e[3],l=e[4],i=e[5],s=void 0===i?0:i,o=e[6],u=void 0===o?0:o,c=new Date(r,a-1,n),f=new Date(l,s-1,u);return{date:c,age:Math.floor((Number(c)-Number(f))/millisInYear$1)}},variable:"DEATH_DATE",name:"deathDates"},URLGlobalPattern=/\{\{URL\|([^\}\}]+)\}\}/g,URLPattern=/URL\|([^\}\}]+)\}\}/,url={globalPattern:URLGlobalPattern,parsePattern:URLPattern,parse:function(t){return slicedToArray(t,2)[1]},variable:"URL",name:"urls"},websiteGlobalPattern=/\[(https?):\/\/((?:www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6})\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)\s+([\w\s]+)\]/g,websitePattern=/\[(https?):\/\/((?:www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6})\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)\s+([\w\s]+)\]/,website={globalPattern:websiteGlobalPattern,parsePattern:websitePattern,parse:function(t){var e=slicedToArray(t,5),r=e[1],a=e[2],n=e[3];return{protocol:r,hostname:a,path:n,title:e[4],url:r+"://"+a+n}},variable:"WEBSITE",name:"websites"},globalPattern$1=/\{\{Extra[^}}]+\}\}/gi,parsePattern=/\|\s?(\w+)\s+=\s+(.+)/g,propPattern=/\|\s?(\w+)\s+=\s+(.+)/,extra={globalPattern:globalPattern$1,parsePattern:parsePattern,parse:function(t){return t.reduce(function(t,e){var r=e.match(propPattern),a=slicedToArray(r,3),n=a[1],l=a[2];return t[n]=l,t},{})},variable:"EXTRA",name:"extra"},convertGlobalPattern=/\{\{convert\|([\d\.]+)\|(\w+)/g,convertPattern=/\{\{convert\|([\d\.]+)\|(\w+)/,convert={globalPattern:convertGlobalPattern,parsePattern:convertPattern,parse:function(t){var e=slicedToArray(t,3);return e[1]+" "+e[2]},variable:"CONVERT",name:"converts"},filmDatesPattern=/\{\{film\sdate([^\}\}]+)\}\}/gi,filmDatePatternGlobal=/(\d+)\|?(\d+)\|?(\d+)\|?([^\|\}]*)\|?(ref\d+=([^\|\}]*))?/g,filmDatePattern=/(\d+)\|?(\d+)\|?(\d+)\|?([^\|\}]*)\|?(ref\d+=([^\|\}]*))?/,filmDates={globalPattern:filmDatesPattern,parsePattern:filmDatePatternGlobal,parse:function(t){return t.map(function(t){var e=t.match(filmDatePattern),r=slicedToArray(e,7),a=(r[0],r[1]),n=r[2],l=r[3],i=r[4],s=(r[5],r[6]);return{date:new Date(a,n&&n-1,l),location:i,ref:s}})},variable:"FILM_DATES",name:"filmDates"},otherGlobalPattern$1=/<ref(\s\w+=[^>]+)?>(.*)<\/ref>/g,otherPattern$1=/<ref(\s\w+=[^>]+)?>(.*)<\/ref>/,attributeGlobalPattern=/(\w+)=(["\w]+)/g,attributePattern=/(\w+)=(["\w]+)/,ref1={globalPattern:otherGlobalPattern$1,parsePattern:otherPattern$1,parse:function(t){var e=slicedToArray(t,3),r=(e[0],e[1]),a=e[2];return{attributes:((r||"").match(attributeGlobalPattern)||[]).reduce(function(t,e){if(e){var r=e.match(attributePattern),a=slicedToArray(r,3),n=(a[0],a[1]),l=a[2];t[n]=l.replace(/"/g,"")}return t},{}),contents:a}},variable:"REF",name:"refs"},otherGlobalPattern$2=/<ref(\s\w+=[^>]+)?\/>/g,otherPattern$2=/<ref(\s\w+=[^>]+)?\/>/,attributeGlobalPattern$1=/(\w+)=(["\w]+)/g,attributePattern$1=/(\w+)=(["\w]+)/,ref2={globalPattern:otherGlobalPattern$2,parsePattern:otherPattern$2,parse:function(t){return{attributes:t[1].match(attributeGlobalPattern$1).reduce(function(t,e){var r=e.match(attributePattern$1),a=slicedToArray(r,3),n=(a[0],a[1]),l=a[2];return t[n]=l.replace(/"/g,""),t},{})}},variable:"REF",name:"refs"},globalPattern$2=/\{\{formatnum:\d+\}\}/gi,parsePattern$1=/\{\{formatnum:(\d+)\}\}/,formatNum={globalPattern:globalPattern$2,parsePattern:parsePattern$1,parse:function(t){var e=slicedToArray(t,2),r=e[1];return parseFloat(r)},variable:"FORMAT_NUM",name:"formatNum"},dataTypes=[instances,ref1,ref2,small,formatNum,flag,coords,marriages,birthDates,labeledDates,deathDates,unbulletedLists,website,hlist,url,convert,nbay,filmDates,other,extra,plainLists,unmarkedLists],dataTypes$1=dataTypes.map(function(t){return{handler:dataType(t),name:t.name,pattern:new RegExp("\\$"+t.variable+"_(\\d+)")}}),keyValueGlobalPattern=/\|\s*([-'\u0400-\u04FF\w\s]+)\s*=\s*([^|]+)?/g,keyValuePattern=/\|\s*([-'\u0400-\u04FF\w\s]+)\s*=\s*([^|]+)?/,numberParse=function(t){return"string"==typeof t&&(t=t.trim().replace(/ /g,""),t.match(/,/)&&t.match(/\./)?t.indexOf(",")<t.indexOf(".")?parseEnglish(t):parseSpanish(t):t.match(/,/)&&!t.match(/\./)?t.match(/,/g).length>1?parseEnglish(t):t.match(/,[0-9]{3}($|^[0-9])/)?parseEnglish(t):parseSpanish(t):!t.match(/,/)&&t.match(/\./)?t.match(/\./g).length>1?parseSpanish(t):t.match(/\.[0-9]{3}($|^[0-9])/)?parseSpanish(t):parseEnglish(t):(+t).toString()===t&&+t)},parseEnglish=function(t){return+t.replace(/,/g,"")},parseSpanish=function(t){return+t.replace(/\./g,"").replace(/,/g,".")},smallDataType=dataTypes$1.find(function(t){return"smalls"===t.name}),blankNamePattern=/blank(\d+)?NameSec2/,blankInfoPattern=/blank(\d+)?InfoSec2/,infoBoxStartPattern=/{{\w*box/,tableStartPattern=/{\|(.*)\n?/,tableEndPattern=/\n\|}/,headersPattern=/!\s?(.*)/g,rowPattern=/\|-/,cellSeparatorPattern=/(?:\n\|)|(?:\|\|)/,linkPattern=/\[\[([^\]]+)\]\]/g,linkNamePattern=/^.*\|/,inlineHeaderPattern="!!",actionPattern=/{{anchor\|(.*)}}/g,rowSpanCountPattern=/rowspan="(\d+)"/,stripLinks=function(t){return t.replace(linkPattern,function(t,e){return e.replace(linkNamePattern,"").trim()||e})},removeActions=function(t){return t.replace(actionPattern,"")},transformCell=function(t){return stripLinks(removeActions(t||"")).replace(rowSpanCountPattern,"").replace(linkNamePattern,"").trim()},transformCells=function(t){return t.split(cellSeparatorPattern).map(transformCell)},findIndex=function(t,e){var r=t.match(e);return r?r.index:-1},findTableStart=function(t){var e=t.match(tableStartPattern);return e?e.index+e[0].length:-1},findTableEnd=function(t){return findIndex(t,tableEndPattern)},getHeaders=function(t){for(var e=[],r=void 0;r=headersPattern.exec(t);)e.push.apply(e,toConsumableArray(r[1].split(inlineHeaderPattern).map(transformCell)));return e},getRows=function(t){var e=t.split(rowPattern).map(function(t){return t.replace(/^.*\n+?\|/,"").trim()}).filter(function(t){return t}),r=[],a=0,n=0,l=[],i=!0,s=!1,o=void 0;try{for(var u,c=e[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){var f=u.value,p=f.match(rowSpanCountPattern);p&&(a=0,n=parseInt(p[1]),l=[]),a<n?(l.push(f),++a===n&&r.push(transformRowSpan(l))):r.push(f)}}catch(t){s=!0,o=t}finally{try{!i&&c.return&&c.return()}finally{if(s)throw o}}return r},getNextTable=function(t,e,r){var a=t,n=findTableStart(a);if(-1===n)return null;a=a.substring(n);var l=findTableEnd(a);if(-1===l)return null;a=a.substring(0,l);var i=getRows(a);if(!i.length)return null;var s=getHeaders(i[0]);return s.length?{data:i.slice(1).map(transformCells).map(function(t){return s.reduce(function(a,n,l){return a[camelCase(fillVariable(n,e,r))]=fillVariables(t[l],e,r),a},{})}),end:n+l}:null},parseTables=function(t,e){for(var r=cleanSource(t,e),a=extractData(r),n=[],l=a.source,i=null;i=getNextTable(l,a.context,e);){if(!i)return n;n.push(i.data),l=l.substring(i.end)}return n},linkPattern$1=/\[\[([^\]]+)\]\]/g,kmPattern=/{{BSkm\|([\dx]+,[\dx]+)\|([\dx]+,[\dx]+)}}/g,parseBsTables=function(t){var e=t.replace(kmPattern,"$1/$2").match(/{{BS([^}}]+)}}/g);return e?e.map(function(t){return clean(t).split("|")}).map(parseRow).filter(function(t){return"-"!==t.type[0]}):null},headingPattern=/[^=]==\s?([\w\s]+)\s?==/g,subheadingPattern=/===([\w\s]+)===/g,tableStartPattern$1=/{{list.+start.*}}/gi,tableEndPattern$1=/{{list.+end.*}}/gi,rowPattern$1=/{{(.*)}}/g,rowPatternSingle=/{{(.*)}}/,parseLists=function(t){var e=getMatches(t,headingPattern),r=getMatches(t,subheadingPattern),a=getTables(t);return a.forEach(function(t){var a=e.filter(function(e){return e.end<t.start}).map(function(t){return t.value});t.heading=last(a);var n=r.filter(function(e){return e.end<t.start}).map(function(t){return t.value});t.subheading=last(n),delete t.start,delete t.end}),a};module.exports=parseInfobox;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVuZGxlLm1pbi5qcyIsInNvdXJjZXMiOlsiLi4vdXRpbC9nZXRWYWx1ZS5qcyIsIi4uL2RhdGEtdHlwZXMvZGF0YVR5cGUuanMiLCIuLi91dGlsL2V4dHJhY3REYXRhLmpzIiwiLi4vdXRpbC9wcm9wZXJ0eUxpc3QuanMiLCIuLi91dGlsL2ZpbGxWYXJpYWJsZXMuanMiLCIuLi91dGlsL2V4dHJhY3RQcm9wZXJ0aWVzLmpzIiwiLi4vdXRpbC90cmFuc2Zvcm1Qcm9wZXJ0aWVzLmpzIiwiLi4vdXRpbC9leHRyYWN0SW5mb2JveGVzLmpzIiwiLi4vdXRpbC9jbGVhblNvdXJjZS5qcyIsIi4uL3V0aWwvcGFyc2VUYWJsZXMuanMiLCIuLi91dGlsL3BhcnNlQnNUYWJsZXMuanMiLCIuLi91dGlsL3BhcnNlTGlzdHMuanMiLCIuLi9pbmRleC5qcyIsIi4uL2RhdGEtdHlwZXMvc21hbGwuanMiLCIuLi9kYXRhLXR5cGVzL2ZsYWcuanMiLCIuLi9kYXRhLXR5cGVzL2Nvb3Jkcy5qcyIsIi4uL2RhdGEtdHlwZXMvaW5zdGFuY2VzLmpzIiwiLi4vZGF0YS10eXBlcy91bmJ1bGxldGVkTGlzdHMuanMiLCIuLi9kYXRhLXR5cGVzL3VubWFya2VkTGlzdHMuanMiLCIuLi9kYXRhLXR5cGVzL3BsYWluTGlzdHMuanMiLCIuLi9kYXRhLXR5cGVzL21hcnJpYWdlcy5qcyIsIi4uL2RhdGEtdHlwZXMvbmJheS5qcyIsIi4uL2RhdGEtdHlwZXMvb3RoZXIuanMiLCIuLi9kYXRhLXR5cGVzL2hsaXN0LmpzIiwiLi4vZGF0YS10eXBlcy9iaXJ0aERhdGVzLmpzIiwiLi4vZGF0YS10eXBlcy9sYWJlbGVkRGF0ZXMuanMiLCIuLi9kYXRhLXR5cGVzL2RlYXRoRGF0ZXMuanMiLCIuLi9kYXRhLXR5cGVzL3VybC5qcyIsIi4uL2RhdGEtdHlwZXMvd2Vic2l0ZS5qcyIsIi4uL2RhdGEtdHlwZXMvZXh0cmEuanMiLCIuLi9kYXRhLXR5cGVzL2NvbnZlcnQuanMiLCIuLi9kYXRhLXR5cGVzL2ZpbG1EYXRlcy5qcyIsIi4uL2RhdGEtdHlwZXMvcmVmMS5qcyIsIi4uL2RhdGEtdHlwZXMvcmVmMi5qcyIsIi4uL2RhdGEtdHlwZXMvZm9ybWF0TnVtLmpzIiwiLi4vZGF0YS10eXBlcy9pbmRleC5qcyIsIi4uL3V0aWwvbnVtYmVyUGFyc2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXh0cmFQcm9wZXJ0eVBhdHRlcm4gPSAvXFxuP1xccz9cXHxcXHM/XFx3KyQvO1xuY29uc3QgZW5kaW5nUGF0dGVybiA9IC9cXG5cXH1cXH0kLztcbmNvbnN0IGxpbmtzUGF0dGVybiA9IC8oKFxcJFxcdytfXFxkKylcXHMqLD9cXHMqKXsyLH0vZztcbmNvbnN0IGxpbmtTZXBhcmF0b3JQYXR0ZXJuID0gL1ssXFxzP10vZztcblxuZnVuY3Rpb24gdHJpbVdyYXBwZXJzKHN0cikge1xuICByZXR1cm4gc3RyXG4gICAgLnJlcGxhY2UoL1xcW1xcWy9nLCAnJylcbiAgICAucmVwbGFjZSgvXFxdXFxdL2csICcnKVxuICAgIC5yZXBsYWNlKC9cXHtcXHsvZywgJycpXG4gICAgLnJlcGxhY2UoL1xcfVxcfS9nLCAnJylcbiAgICAudHJpbSgpO1xufVxuXG5mdW5jdGlvbiB0cmltT3Ioc3RyKSB7XG4gIGNvbnN0IG9yUG9zaXRpb24gPSBzdHIuaW5kZXhPZignfCcpO1xuICBpZiAob3JQb3NpdGlvbiAhPT0gLTEpIHtcbiAgICByZXR1cm4gc3RyLnN1YnN0cmluZygwLCBvclBvc2l0aW9uKTtcbiAgfVxuICByZXR1cm4gc3RyO1xufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBnZXRWYWx1ZShyYXcsIGtleSkge1xuICBpZiAoIXJhdykge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgY29uc3QgY2xlYW5zZWQgPSByYXdcbiAgICAudHJpbSgpXG4gICAgLnJlcGxhY2UoL0ZpbGU6LywgJycpXG4gICAgLy8gSGF2ZSBub3QgZm91bmQgcmVhc29uIGZvciB0aGlzIGJ1dCBpdCBicmVha3MgcGFyc2luZywgc28gd2UgYXJlIGp1c3RcbiAgICAvLyByZW1vdmluZyBpdCBmb3Igbm93XG4gICAgLnJlcGxhY2UoL1xce1xce1xcZCtcXH1cXH0vZywgJycpXG4gICAgLnJlcGxhY2UoZXh0cmFQcm9wZXJ0eVBhdHRlcm4sICcnKVxuICAgIC5yZXBsYWNlKGVuZGluZ1BhdHRlcm4sICcnKTtcblxuICBpZiAoY2xlYW5zZWQgPT09ICd5JyB8fCBjbGVhbnNlZCA9PT0gJ3llcycpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGlmIChrZXkgPT0gJ2JpcnRoUGxhY2UnKSB7XG4gICAgcmV0dXJuIHJhdy50cmltKCk7XG4gIH1cblxuICAvLyBJcyBpdCBhIGxpc3Qgb2YgbGlua3M/P1xuICBjb25zdCBsaW5rcyA9IGNsZWFuc2VkLm1hdGNoKGxpbmtzUGF0dGVybik7XG4gIGlmIChsaW5rcykge1xuICAgIHJldHVybiBsaW5rc1swXS5zcGxpdChsaW5rU2VwYXJhdG9yUGF0dGVybikuZmlsdGVyKHRleHQgPT4gdGV4dCk7XG4gIH1cblxuICByZXR1cm4gdHJpbU9yKHRyaW1XcmFwcGVycyhjbGVhbnNlZCkpO1xufVxuIiwiZXhwb3J0IGNvbnN0IERPX05PVF9SRVBMQUNFID0gU3ltYm9sKCdETyBOT1QgUkVQTEFDRScpO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBkYXRhVHlwZSh7XG4gIGdsb2JhbFBhdHRlcm4sXG4gIHBhcnNlUGF0dGVybixcbiAgcGFyc2UsXG4gIHZhcmlhYmxlLFxuICBuYW1lLFxufSkge1xuICByZXR1cm4gKHNvdXJjZSkgPT4ge1xuICAgIGNvbnN0IG1hdGNoZXMgPSBzb3VyY2UubWF0Y2goZ2xvYmFsUGF0dGVybik7XG4gICAgaWYgKCFtYXRjaGVzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBbbmFtZV06IFtdLFxuICAgICAgICBzb3VyY2VBZnRlcjogc291cmNlLFxuICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgaW5zdGFuY2VzID0gbWF0Y2hlcy5tYXAoKG1hdGNoKSA9PiBwYXJzZShtYXRjaC5tYXRjaChwYXJzZVBhdHRlcm4pKSk7XG4gICAgY29uc3Qgc291cmNlQWZ0ZXIgPSBtYXRjaGVzLnJlZHVjZSgobWVtbywgbWF0Y2gsIGluZGV4KSA9PiB7XG4gICAgICBpZiAoaW5zdGFuY2VzW2luZGV4XSA9PT0gRE9fTk9UX1JFUExBQ0UpIHtcbiAgICAgICAgcmV0dXJuIG1lbW87XG4gICAgICB9XG4gICAgICByZXR1cm4gbWVtby5yZXBsYWNlKG1hdGNoLCBgJCR7dmFyaWFibGV9XyR7aW5kZXh9YCk7XG4gICAgfSwgc291cmNlKTtcbiAgICByZXR1cm4ge1xuICAgICAgZGF0YToge1xuICAgICAgICBbbmFtZV06IGluc3RhbmNlcyxcbiAgICAgIH0sXG4gICAgICBzb3VyY2VBZnRlcixcbiAgICB9O1xuICB9O1xufVxuIiwiaW1wb3J0IGRhdGFUeXBlcyBmcm9tICcuLi9kYXRhLXR5cGVzL2luZGV4JztcblxuZnVuY3Rpb24gYnlEYXRhSGFuZGxlcih7IHNvdXJjZSwgY29udGV4dCB9LCBoYW5kbGVyKSB7XG4gIGNvbnN0IHsgZGF0YSwgc291cmNlQWZ0ZXIgfSA9IGhhbmRsZXIoc291cmNlKTtcbiAgcmV0dXJuIHtcbiAgICBjb250ZXh0OiBPYmplY3QuYXNzaWduKHt9LCBjb250ZXh0LCBkYXRhKSxcbiAgICBzb3VyY2U6IHNvdXJjZUFmdGVyLFxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBleHRyYWN0RGF0YShzb3VyY2UpIHtcbiAgcmV0dXJuIGRhdGFUeXBlc1xuICAgIC5tYXAodHlwZSA9PiB0eXBlLmhhbmRsZXIpXG4gICAgLnJlZHVjZShieURhdGFIYW5kbGVyLCB7XG4gICAgICBjb250ZXh0OiB7fSxcbiAgICAgIHNvdXJjZSxcbiAgICB9KTtcbn1cbiIsImltcG9ydCBnZXRWYWx1ZSBmcm9tICcuL2dldFZhbHVlJztcbmltcG9ydCBjYW1lbENhc2UgZnJvbSAnY2FtZWxjYXNlJztcblxuY29uc3Qga2V5VmFsdWVHbG9iYWxQYXR0ZXJuID0gL1xcfFxccyooWy0nXFx1MDQwMC1cXHUwNEZGXFx3XFxzXSspXFxzKj1cXHMqKFtefF0rKT8vZztcbmNvbnN0IGtleVZhbHVlUGF0dGVybiA9IC9cXHxcXHMqKFstJ1xcdTA0MDAtXFx1MDRGRlxcd1xcc10rKVxccyo9XFxzKihbXnxdKyk/LztcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZmluZFByb3BlcnR5TGlzdChzb3VyY2UpIHtcbiAgY29uc3Qga2V5VmFsdWVQYWlycyA9IHNvdXJjZS5tYXRjaChrZXlWYWx1ZUdsb2JhbFBhdHRlcm4pO1xuICBpZiAoIWtleVZhbHVlUGFpcnMpIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgcmV0dXJuIGtleVZhbHVlUGFpcnNcbiAgICAubWFwKG1hdGNoID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGtleVZhbHVlUGF0dGVybi5leGVjKG1hdGNoKTtcbiAgICAgIGlmICghcmVzdWx0KSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY29uc3QgWywgcmF3S2V5LCByYXdWYWx1ZV0gPSByZXN1bHQ7XG4gICAgICBjb25zdCBrZXkgPSBjYW1lbENhc2UocmF3S2V5LnRyaW0oKSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBrZXksXG4gICAgICAgIHZhbHVlOiBnZXRWYWx1ZShyYXdWYWx1ZSwga2V5KSxcbiAgICAgIH07XG4gICAgfSlcbiAgICAuZmlsdGVyKGl0ZW0gPT4gaXRlbSk7XG59XG4iLCJpbXBvcnQgZGF0YVR5cGVzIGZyb20gJy4uL2RhdGEtdHlwZXMvaW5kZXgnO1xuXG5leHBvcnQgZnVuY3Rpb24gZmlsbFZhcmlhYmxlKHZhbHVlLCBjb250ZXh0LCB7IHNpbXBsaWZ5RGF0YVZhbHVlcyB9ID0ge30pIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpIHtcbiAgICBjb25zb2xlLmxvZyhcbiAgICAgIGBXYXJuaW5nOiBTb21ldGhpbmcgd2VudCB3cm9uZy4gQ291bGQgbm90IGZpbGwgdmFyaWFibGVzIGluOiAoJHt0eXBlb2YgdmFsdWV9KSAke0pTT04uc3RyaW5naWZ5KFxuICAgICAgICB2YWx1ZVxuICAgICAgKX1gXG4gICAgKTtcbiAgICByZXR1cm4ge307XG4gIH1cbiAgY29uc3QgZGF0YVR5cGUgPSBkYXRhVHlwZXMuZmluZCgodHlwZSkgPT4gdmFsdWUubWF0Y2godHlwZS5wYXR0ZXJuKSk7XG4gIGlmIChkYXRhVHlwZSkge1xuICAgIGNvbnN0IFttYXRjaGVkLCBpbmRleF0gPSBkYXRhVHlwZS5wYXR0ZXJuLmV4ZWModmFsdWUpO1xuICAgIGNvbnN0IGRhdGFWYWx1ZSA9IGNvbnRleHRbZGF0YVR5cGUubmFtZV1bcGFyc2VJbnQoaW5kZXgsIDEwKV07XG4gICAgaWYgKCFzaW1wbGlmeURhdGFWYWx1ZXMgJiYgdHlwZW9mIGRhdGFWYWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiB2YWx1ZS5yZXBsYWNlKG1hdGNoZWQsIGRhdGFWYWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiBkYXRhVmFsdWU7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG4vLyBSZWN1cnNpdmUgdmFyYWlibGUgZmlsbGluZy4uLiBldmVuIGhhbmRsZXMgYXJyYXlzIG9mIHZhbHVlc1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZmlsbFZhcmlhYmxlcyh2YWx1ZSwgY29udGV4dCwgb3B0aW9ucykge1xuICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICBpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgIHJldHVybiB2YWx1ZS5tYXAoKGl0ZW0pID0+IGZpbGxWYXJpYWJsZXMoaXRlbSwgY29udGV4dCwgb3B0aW9ucykpO1xuICB9XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHZhbHVlKS5yZWR1Y2UoKG1lbW8sIGtleSkgPT4ge1xuICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24obWVtbywge1xuICAgICAgICBba2V5XTogZmlsbFZhcmlhYmxlcyh2YWx1ZVtrZXldLCBjb250ZXh0LCBvcHRpb25zKSxcbiAgICAgIH0pO1xuICAgIH0sIHt9KTtcbiAgICAvLyByZXR1cm4gdmFsdWUubWFwKGl0ZW0gPT4gZmlsbFZhcmlhYmxlcyhpdGVtLCBjb250ZXh0LCBvcHRpb25zKSk7XG4gIH1cbiAgY29uc3QgZmlsbGVkID0gZmlsbFZhcmlhYmxlKHZhbHVlLCBjb250ZXh0LCBvcHRpb25zKTtcbiAgaWYgKGZpbGxlZCA9PT0gdmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgcmV0dXJuIGZpbGxWYXJpYWJsZXMoZmlsbGVkLCBjb250ZXh0LCBvcHRpb25zKTtcbn1cbiIsImltcG9ydCBkYXRhVHlwZXMgZnJvbSAnLi4vZGF0YS10eXBlcy9pbmRleCc7XG5pbXBvcnQgZmluZFByb3BlcnR5TGlzdCBmcm9tICcuL3Byb3BlcnR5TGlzdCc7XG5pbXBvcnQgbnVtYmVyUGFyc2UgZnJvbSAnLi9udW1iZXJQYXJzZSc7XG5pbXBvcnQgZmlsbFZhcmlhYmxlcyBmcm9tICcuL2ZpbGxWYXJpYWJsZXMnO1xuXG5jb25zdCBzbWFsbERhdGFUeXBlID0gZGF0YVR5cGVzLmZpbmQoKHR5cGUpID0+IHR5cGUubmFtZSA9PT0gJ3NtYWxscycpO1xuXG5mdW5jdGlvbiBoYW5kbGVTbWFsbERhdGEodmFsdWUsIGNvbnRleHQsIHsgc2ltcGxpZnlEYXRhVmFsdWVzIH0pIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgJiYgdmFsdWUubWF0Y2goc21hbGxEYXRhVHlwZS5wYXR0ZXJuKSkge1xuICAgIGNvbnN0IHByaW1hcnkgPSB2YWx1ZVxuICAgICAgLnJlcGxhY2Uoc21hbGxEYXRhVHlwZS5wYXR0ZXJuLCAnJylcbiAgICAgIC8vIENsZWFuaW5nIHVwIGZyb20gaW5zZXJ0ZWQgY29tbWFzXG4gICAgICAucmVwbGFjZSgvLC8sICcnKVxuICAgICAgLnRyaW0oKTtcbiAgICBjb25zdCBbLCBpbmRleF0gPSBzbWFsbERhdGFUeXBlLnBhdHRlcm4uZXhlYyh2YWx1ZSk7XG4gICAgY29uc3Qgc2Vjb25kYXJ5ID0gY29udGV4dFtzbWFsbERhdGFUeXBlLm5hbWVdW3BhcnNlSW50KGluZGV4LCAxMCldO1xuICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgIHByaW1hcnk6IGdldFZhcmlhYmxlVmFsdWUocHJpbWFyeSwgY29udGV4dCwgeyBzaW1wbGlmeURhdGFWYWx1ZXMgfSksXG4gICAgICBzZWNvbmRhcnk6IGdldFZhcmlhYmxlVmFsdWUoc2Vjb25kYXJ5LCBjb250ZXh0LCB7IHNpbXBsaWZ5RGF0YVZhbHVlcyB9KSxcbiAgICB9O1xuICAgIHJldHVybiBzaW1wbGlmeURhdGFWYWx1ZXMgPyByZXN1bHQucHJpbWFyeSA6IHJlc3VsdDtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn1cblxuZnVuY3Rpb24gZ2V0VmFyaWFibGVWYWx1ZSh2YWx1ZSwgY29udGV4dCwgeyBzaW1wbGlmeURhdGFWYWx1ZXMgfSA9IHt9KSB7XG4gIC8vIEhhbmRsaW5nIHNtYWxsIGRhdGEgZGlmZmVyZW50bHkuLi4gSSBkb250IGxpa2UgdGhpcy4uLlxuICBjb25zdCBzbWFsbERhdGEgPSBoYW5kbGVTbWFsbERhdGEodmFsdWUsIGNvbnRleHQsIHsgc2ltcGxpZnlEYXRhVmFsdWVzIH0pO1xuICBpZiAoc21hbGxEYXRhKSB7XG4gICAgcmV0dXJuIHNtYWxsRGF0YTtcbiAgfVxuICByZXR1cm4gZmlsbFZhcmlhYmxlcyh2YWx1ZSwgY29udGV4dCwgeyBzaW1wbGlmeURhdGFWYWx1ZXMgfSk7XG59XG5cbmZ1bmN0aW9uIHJlZHVjZVZhcmlhYmxlKGtleSwgdmFsdWUsIGNvbnRleHQsIG9wdGlvbnMpIHtcbiAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIC8vIEZpcnN0IGFycmF5IHBhc3MuLi5cbiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgcmV0dXJuIHZhbHVlLm1hcCgoaXRlbSkgPT4gZ2V0VmFyaWFibGVWYWx1ZShpdGVtLCBjb250ZXh0LCBvcHRpb25zKSk7XG4gIH1cbiAgaWYgKGtleS5tYXRjaCgvYXJlYVRvdGFsLykgfHwga2V5Lm1hdGNoKC9wb3B1bGF0aW9uLykpIHtcbiAgICBsZXQgZmxvYXQgPSBudW1iZXJQYXJzZSh2YWx1ZSk7XG4gICAgaWYgKGZsb2F0ID09PSBmYWxzZSkgZmxvYXQgPSBwYXJzZUZsb2F0KHZhbHVlLCAxMCk7XG4gICAgaWYgKCFpc05hTihmbG9hdCkpIHtcbiAgICAgIHJldHVybiBmbG9hdDtcbiAgICB9XG4gIH1cbiAgaWYgKGtleS5tYXRjaCgvZGF0ZS9pKSkge1xuICAgIGNvbnN0IGRhdGVWYWx1ZSA9ICtuZXcgRGF0ZSh2YWx1ZSk7XG4gICAgaWYgKCFpc05hTihkYXRlVmFsdWUpKSB7XG4gICAgICByZXR1cm4gbmV3IERhdGUodmFsdWUpO1xuICAgIH1cbiAgfVxuICBjb25zdCB2YXJpYWJsZVZhbHVlID0gZ2V0VmFyaWFibGVWYWx1ZSh2YWx1ZSwgY29udGV4dCwgb3B0aW9ucyk7XG5cbiAgLy8gU2Vjb25kIGFycmF5IHBhc3MuIElmIGZpcnN0IHZhcmlhYmxlIHdhcyBhbiBhcnJheSBvZiB2YXJpYWJsZXMuXG4gIGlmIChBcnJheS5pc0FycmF5KHZhcmlhYmxlVmFsdWUpKSB7XG4gICAgcmV0dXJuIHZhcmlhYmxlVmFsdWUubWFwKChpdGVtKSA9PlxuICAgICAgZ2V0VmFyaWFibGVWYWx1ZShpdGVtLCBjb250ZXh0LCBvcHRpb25zKVxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHZhcmlhYmxlVmFsdWU7XG59XG5cbmZ1bmN0aW9uIGJ5VmFyaWFibGVSZWR1Y3Rpb24oY29udGV4dCwgb3B0aW9ucykge1xuICByZXR1cm4gKG1lbW8sIHsga2V5LCB2YWx1ZSB9KSA9PiB7XG4gICAgY29uc3QgcmVkdWNlZCA9IHJlZHVjZVZhcmlhYmxlKGtleSwgdmFsdWUsIGNvbnRleHQsIG9wdGlvbnMpO1xuICAgIGlmIChyZWR1Y2VkID09PSAnJyB8fCByZWR1Y2VkID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gbWVtbztcbiAgICB9XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIG1lbW8sIHtcbiAgICAgIFtrZXldOiByZWR1Y2VkLFxuICAgIH0pO1xuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBleHRyYWN0UHJvcGVydGllcyhcbiAgeyBzb3VyY2UsIGNvbnRleHQgfSxcbiAgeyBzaW1wbGlmeURhdGFWYWx1ZXMgPSB0cnVlIH0gPSB7fVxuKSB7XG4gIHJldHVybiBmaW5kUHJvcGVydHlMaXN0KHNvdXJjZSkucmVkdWNlKFxuICAgIGJ5VmFyaWFibGVSZWR1Y3Rpb24oY29udGV4dCwgeyBzaW1wbGlmeURhdGFWYWx1ZXMgfSksXG4gICAge31cbiAgKTtcbn1cbiIsIi8vIGltcG9ydCBnZXRWYWx1ZSBmcm9tICcuL2dldFZhbHVlJztcbmltcG9ydCBjYW1lbENhc2UgZnJvbSAnY2FtZWxjYXNlJztcblxuY29uc3QgYmxhbmtOYW1lUGF0dGVybiA9IC9ibGFuayhcXGQrKT9OYW1lU2VjMi87XG5jb25zdCBibGFua0luZm9QYXR0ZXJuID0gL2JsYW5rKFxcZCspP0luZm9TZWMyLztcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gdHJhbnNmb3JtUHJvcGVydGllcyhwcm9wZXJ0aWVzKSB7XG4gIHJldHVybiBPYmplY3Qua2V5cyhwcm9wZXJ0aWVzKVxuICAgIC5yZWR1Y2UoKHRyYW5zZm9ybWVkLCBrZXkpID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gcHJvcGVydGllc1trZXldO1xuICAgICAgY29uc3QgbWF0Y2ggPSBrZXkubWF0Y2goYmxhbmtOYW1lUGF0dGVybik7XG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgY29uc3QgaWQgPSBtYXRjaFsxXSB8fCAnJztcbiAgICAgICAgY29uc3QgYmxhbmtOYW1lID0gcHJvcGVydGllc1tgYmxhbmske2lkfU5hbWVTZWMyYF07XG4gICAgICAgIGNvbnN0IGJsYW5rSW5mbyA9IHByb3BlcnRpZXNbYGJsYW5rJHtpZH1JbmZvU2VjMmBdO1xuICAgICAgICBpZiAodHlwZW9mIGJsYW5rTmFtZSAhPT0gJ3N0cmluZycpIHJldHVybiB0cmFuc2Zvcm1lZDtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24odHJhbnNmb3JtZWQsIHtcbiAgICAgICAgICBbY2FtZWxDYXNlKGJsYW5rTmFtZSldOiBibGFua0luZm8sXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKGtleS5tYXRjaChibGFua0luZm9QYXR0ZXJuKSkge1xuICAgICAgICByZXR1cm4gdHJhbnNmb3JtZWQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih0cmFuc2Zvcm1lZCwge1xuICAgICAgICBba2V5XTogdmFsdWUsXG4gICAgICB9KTtcbiAgICB9LCB7fSk7XG59XG4iLCJmdW5jdGlvbiBmaW5kT3V0ZXJJbmRleChzb3VyY2UpIHtcblx0bGV0IGxhc3RPcGVuID0gW107XG5cdGZvciAobGV0IGkgPSAwOyBpIDwgc291cmNlLmxlbmd0aCAtIDE7IGkrKykge1xuICAgIGNvbnN0IG5leHRUd28gPSBzb3VyY2Uuc3Vic3RyKGksIDIpO1xuICAgIGlmIChuZXh0VHdvID09PSAne3snKSB7XG5cdFx0XHRsYXN0T3Blbi5wdXNoKGkpO1xuXHRcdFx0Ly8gTW92ZSBmb3J3YXJkLCBzbyB3ZSBkbyBub3QgY291bnQgY2xvc3VyZXMgcmlnaHQgbmV4dCB0byBlYWNoIG90aGVyXG5cdFx0XHRpKys7XG5cdFx0XHRjb250aW51ZTtcblx0XHR9XG4gICAgaWYgKG5leHRUd28gPT09ICd9fScpIHtcblx0XHRcdGNvbnN0IG9wZW5BdCA9IGxhc3RPcGVuLnBvcCgpO1xuXHRcdFx0aWYgKGxhc3RPcGVuLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0XHQvLyBBZGRpbmcgMiBoZXJlIGZvciB0aGUgY2xvc3VyZVxuXHRcdFx0XHRyZXR1cm4gaSArIDI7XG5cdFx0XHR9XG5cdFx0XHQvLyBNb3ZlIGZvcndhcmQsIHNvIHdlIGRvIG5vdCBjb3VudCBjbG9zdXJlcyByaWdodCBuZXh0IHRvIGVhY2ggb3RoZXJcblx0XHRcdGkrKztcblx0XHR9ICAgIFxuICB9XG59XG5cbmNvbnN0IGluZm9Cb3hTdGFydFBhdHRlcm4gPSAve3tcXHcqYm94LztcblxuZnVuY3Rpb24gcGFyc2Uoc291cmNlKSB7XG5cdGNvbnN0IHN0YXJ0TWF0Y2ggPSBzb3VyY2UubWF0Y2goaW5mb0JveFN0YXJ0UGF0dGVybik7XG5cdGlmICghc3RhcnRNYXRjaCkge1xuXHRcdC8vIE1heSBub3QgaGF2ZSBhIGEgcHJvcGVyIGluZm9ib3ggd3JhcHBlciwgbGV0J3MgdXNlIHRoZSBlbnRpcmUgc291cmNlXG5cdFx0Ly8gYnkgZGVmYXVsdFxuXHRcdHJldHVybiB7IGRhdGE6IHNvdXJjZSwgc291cmNlTGVmdDogbnVsbCB9O1xuXHR9XG5cdGNvbnN0IHN0YXJ0SW5kZXggPSBzdGFydE1hdGNoLmluZGV4O1xuXHRjb25zdCB3aXRoU3RhcnQgPSBzb3VyY2Uuc3Vic3RyaW5nKHN0YXJ0SW5kZXgpO1xuXHRjb25zdCBvdXRlckluZGV4ID0gZmluZE91dGVySW5kZXgod2l0aFN0YXJ0KTtcblx0aWYgKCFvdXRlckluZGV4KSB7XG5cdFx0cmV0dXJuIHsgZGF0YTogc291cmNlLCBzb3VyY2VMZWZ0OiBudWxsIH07XG5cdH1cblx0Y29uc3QgZGF0YSA9IHdpdGhTdGFydC5zdWJzdHJpbmcoMCwgb3V0ZXJJbmRleCk7XG5cdGNvbnN0IHNvdXJjZUxlZnQgPSBzb3VyY2Uuc3Vic3RyaW5nKG91dGVySW5kZXgpO1xuXHRjb25zdCBzb3VyY2VMZWZ0SGFzTWF0Y2ggPSAhIXNvdXJjZUxlZnQubWF0Y2goaW5mb0JveFN0YXJ0UGF0dGVybik7XG5cdHJldHVybiB7XG5cdFx0ZGF0YSxcblx0XHRzb3VyY2VMZWZ0OiBzb3VyY2VMZWZ0SGFzTWF0Y2ggPyBzb3VyY2VMZWZ0IDogbnVsbFxuXHR9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBleHRyYWN0SW5mb2JveGVzKHNvdXJjZSkge1xuICBsZXQgcGFyc2VkID0gcGFyc2Uoc291cmNlKTtcbiAgY29uc3QgaW5mb2JveGVzID0gW3BhcnNlZC5kYXRhXTtcbiAgd2hpbGUocGFyc2VkLnNvdXJjZUxlZnQpIHtcbiAgXHRwYXJzZWQgPSBwYXJzZShwYXJzZWQuc291cmNlTGVmdCk7XG4gIFx0aW5mb2JveGVzLnB1c2gocGFyc2VkLmRhdGEpO1xuICB9XG4gIHJldHVybiBpbmZvYm94ZXM7XG59XG4iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjbGVhblNvdXJjZShcbiAgc291cmNlLFxuICB7IHJlbW92ZVNtYWxsID0gZmFsc2UsIHJlbW92ZVJlZmVyZW5jZXMgPSB0cnVlIH0gPSB7fVxuKSB7XG4gIGlmIChyZW1vdmVSZWZlcmVuY2VzKSB7XG4gICAgc291cmNlID0gc291cmNlXG4gICAgICAucmVwbGFjZSgvPHJlZihcXHNcXHcrPVtePl0rKT8+Lio8XFwvcmVmPi9nLCAnJylcbiAgICAgIC5yZXBsYWNlKC88cmVmKFxcc1xcdys9W14+XSspP1xccz9cXC8+L2csICcnKTtcbiAgfVxuXG4gIGlmIChyZW1vdmVTbWFsbCkge1xuICAgIHNvdXJjZSA9IHNvdXJjZS5yZXBsYWNlKC88c21hbGw+Lio8XFwvc21hbGw+L2csICcnKTtcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgc291cmNlXG4gICAgICAvLyBSZW1vdmUgdGlja3NcbiAgICAgIC5yZXBsYWNlKC8nJyc/L2csICcnKVxuICAgICAgLnJlcGxhY2UoL1xcfGRpc3BsYXk9aW5saW5lL2csICcnKVxuICAgICAgLy8gVGhpcyBpcyBhIGxpdHRsZSBpZmZ5XG4gICAgICAucmVwbGFjZSgvPGJyXFxzP1xcLz8+L2csICcsJylcbiAgICAgIC5yZXBsYWNlKC8mbWludXM7L2csICctJylcbiAgICAgIC5yZXBsYWNlKC88c3VwPi9nLCAnXicpXG4gICAgICAvLyBSZW1vdmUgc2hvcnRlbmVkIGZvb3Rub3RlIHRlbXBsYXRlc1xuICAgICAgLnJlcGxhY2UoL1xce1xce3NmblxcfChbXlxcfVxcfV0rKVxcfVxcfS9nLCAnJylcbiAgICAgIC8vIFJlbW92ZSBleHBsYW5hdG9yeSBmb290bm90ZXNcbiAgICAgIC5yZXBsYWNlKC9cXHtcXHtlZm5cXHwoW15cXH1cXH1dKylcXH1cXH0vZywgJycpXG4gICAgICAucmVwbGFjZSgv4oiSL2csICctJylcbiAgICAgIC5yZXBsYWNlKC88XFwvc3VwPi9nLCAnJylcbiAgICAgIC8vIFJlcGxhY2Ugbm93cmFwIHRlbXBsYXRlIHdpdGggaXRzIGNvbnRlbnRcbiAgICAgIC5yZXBsYWNlKC9cXHtcXHtcXHMqbm93cmFwXFxzKlxcfChbXlxcblxcfV0rKVxcfVxcfS9naSwgJyQxJylcbiAgICAgIC8vIEhUTUwgY29tbWVudHNcbiAgICAgIC5yZXBsYWNlKC88IS0tKFtcXHNcXFNdKj8pLS0+L2csICcnKVxuICAgICAgLnJlcGxhY2UoLyZuYnNwOy9nLCAnICcpXG4gICAgICAucmVwbGFjZShcInwnJ1NlZSBsaXN0JydcIiwgJycpXG4gICk7XG59XG4iLCJpbXBvcnQgY2FtZWxjYXNlIGZyb20gJ2NhbWVsY2FzZSc7XG5pbXBvcnQgZXh0cmFjdERhdGEgZnJvbSAnLi9leHRyYWN0RGF0YSc7XG5pbXBvcnQgY2xlYW5Tb3VyY2UgZnJvbSAnLi9jbGVhblNvdXJjZSc7XG5pbXBvcnQgZmlsbFZhcmlhYmxlcywgeyBmaWxsVmFyaWFibGUgfSBmcm9tICcuL2ZpbGxWYXJpYWJsZXMnO1xuXG5jb25zdCB0YWJsZVN0YXJ0UGF0dGVybiA9IC97XFx8KC4qKVxcbj8vO1xuY29uc3QgdGFibGVFbmRQYXR0ZXJuID0gL1xcblxcfH0vO1xuY29uc3QgaGVhZGVyc1BhdHRlcm4gPSAvIVxccz8oLiopL2c7XG5jb25zdCByb3dQYXR0ZXJuID0gL1xcfC0vO1xuY29uc3QgY2VsbFNlcGFyYXRvclBhdHRlcm4gPSAvKD86XFxuXFx8KXwoPzpcXHxcXHwpLztcbmNvbnN0IGxpbmtQYXR0ZXJuID0gL1xcW1xcWyhbXlxcXV0rKVxcXVxcXS9nO1xuY29uc3QgbGlua05hbWVQYXR0ZXJuID0gL14uKlxcfC87XG5jb25zdCBpbmxpbmVIZWFkZXJQYXR0ZXJuID0gJyEhJztcbmNvbnN0IGFjdGlvblBhdHRlcm4gPSAve3thbmNob3JcXHwoLiopfX0vZztcbmNvbnN0IHJvd1NwYW5Db3VudFBhdHRlcm4gPSAvcm93c3Bhbj1cIihcXGQrKVwiLztcblxuY29uc3Qgc3RyaXBMaW5rcyA9IChzb3VyY2UpID0+XG4gIHNvdXJjZS5yZXBsYWNlKGxpbmtQYXR0ZXJuLCAobSwgY2FwdHVyZSkgPT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGNhcHR1cmUucmVwbGFjZShsaW5rTmFtZVBhdHRlcm4sICcnKS50cmltKCk7XG4gICAgcmV0dXJuIHJlc3VsdCB8fCBjYXB0dXJlO1xuICB9KTtcbmNvbnN0IHJlbW92ZUFjdGlvbnMgPSAoc291cmNlKSA9PiBzb3VyY2UucmVwbGFjZShhY3Rpb25QYXR0ZXJuLCAnJyk7XG5jb25zdCB0cmFuc2Zvcm1DZWxsID0gKHNvdXJjZSkgPT5cbiAgc3RyaXBMaW5rcyhyZW1vdmVBY3Rpb25zKHNvdXJjZSB8fCAnJykpXG4gICAgLnJlcGxhY2Uocm93U3BhbkNvdW50UGF0dGVybiwgJycpXG4gICAgLnJlcGxhY2UobGlua05hbWVQYXR0ZXJuLCAnJylcbiAgICAudHJpbSgpO1xuXG5jb25zdCB0cmFuc2Zvcm1DZWxscyA9IChyb3cpID0+XG4gIHJvdy5zcGxpdChjZWxsU2VwYXJhdG9yUGF0dGVybikubWFwKHRyYW5zZm9ybUNlbGwpO1xuXG5jb25zdCBmaW5kSW5kZXggPSAodCwgcCkgPT4ge1xuICBjb25zdCBtID0gdC5tYXRjaChwKTtcbiAgcmV0dXJuIG0gPyBtLmluZGV4IDogLTE7XG59O1xuXG5jb25zdCBmaW5kVGFibGVTdGFydCA9IChzb3VyY2UpID0+IHtcbiAgY29uc3QgbSA9IHNvdXJjZS5tYXRjaCh0YWJsZVN0YXJ0UGF0dGVybik7XG4gIHJldHVybiBtID8gbS5pbmRleCArIG1bMF0ubGVuZ3RoIDogLTE7XG59O1xuY29uc3QgZmluZFRhYmxlRW5kID0gKHNvdXJjZSkgPT4gZmluZEluZGV4KHNvdXJjZSwgdGFibGVFbmRQYXR0ZXJuKTtcblxuY29uc3QgZ2V0SGVhZGVycyA9IChzb3VyY2UpID0+IHtcbiAgY29uc3QgaGVhZGVycyA9IFtdO1xuICBsZXQgbWF0Y2g7XG4gIHdoaWxlICgobWF0Y2ggPSBoZWFkZXJzUGF0dGVybi5leGVjKHNvdXJjZSkpKSB7XG4gICAgaGVhZGVycy5wdXNoKC4uLm1hdGNoWzFdLnNwbGl0KGlubGluZUhlYWRlclBhdHRlcm4pLm1hcCh0cmFuc2Zvcm1DZWxsKSk7XG4gIH1cbiAgcmV0dXJuIGhlYWRlcnM7XG59O1xuXG5mdW5jdGlvbiB0cmFuc2Zvcm1Sb3dTcGFuKHJvd3MpIHtcbiAgcmV0dXJuIHJvd3NcbiAgICAubWFwKHRyYW5zZm9ybUNlbGxzKVxuICAgIC5yZWR1Y2UoKG1lcmdlZCwgY2VsbHMsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBrID0gaW5kZXggPT09IDAgPyAwIDogMTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2VsbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKCFtZXJnZWRbaSArIGtdKSBtZXJnZWRbaSArIGtdID0ge307XG4gICAgICAgIGlmIChjZWxsc1tpXSkge1xuICAgICAgICAgIG1lcmdlZFtpICsga11bY2VsbHNbaV1dID0gMTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIG1lcmdlZDtcbiAgICB9LCBbXSlcbiAgICAubWFwKChvKSA9PiBPYmplY3Qua2V5cyhvKS5qb2luKCcsJykpXG4gICAgLmpvaW4oJyB8fCAnKTtcbn1cblxuY29uc3QgZ2V0Um93cyA9IChzb3VyY2UpID0+IHtcbiAgY29uc3QgcmF3ID0gc291cmNlXG4gICAgLnNwbGl0KHJvd1BhdHRlcm4pXG4gICAgLm1hcCgoZSkgPT4gZS5yZXBsYWNlKC9eLipcXG4rP1xcfC8sICcnKS50cmltKCkpXG4gICAgLmZpbHRlcigoZSkgPT4gZSk7XG5cbiAgY29uc3Qgcm93cyA9IFtdO1xuICBsZXQgc3Bhbk4gPSAwO1xuICBsZXQgc3BhbkNvdW50ID0gMDtcbiAgbGV0IHJvd3NJblNwYW4gPSBbXTtcblxuICBmb3IgKGNvbnN0IHJvdyBvZiByYXcpIHtcbiAgICBjb25zdCBtYXRjaCA9IHJvdy5tYXRjaChyb3dTcGFuQ291bnRQYXR0ZXJuKTtcbiAgICBpZiAobWF0Y2gpIHtcbiAgICAgIHNwYW5OID0gMDtcbiAgICAgIHNwYW5Db3VudCA9IHBhcnNlSW50KG1hdGNoWzFdKTtcbiAgICAgIHJvd3NJblNwYW4gPSBbXTtcbiAgICB9XG4gICAgaWYgKHNwYW5OIDwgc3BhbkNvdW50KSB7XG4gICAgICByb3dzSW5TcGFuLnB1c2gocm93KTtcbiAgICAgIGlmICgrK3NwYW5OID09PSBzcGFuQ291bnQpIHtcbiAgICAgICAgcm93cy5wdXNoKHRyYW5zZm9ybVJvd1NwYW4ocm93c0luU3BhbikpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByb3dzLnB1c2gocm93KTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gcm93cztcbn07XG5cbmNvbnN0IGdldE5leHRUYWJsZSA9IChzb3VyY2UsIGNvbnRleHQsIG9wdGlvbnMpID0+IHtcbiAgbGV0IGxlZnQgPSBzb3VyY2U7XG4gIGNvbnN0IHN0YXJ0ID0gZmluZFRhYmxlU3RhcnQobGVmdCk7XG5cbiAgaWYgKHN0YXJ0ID09PSAtMSkgcmV0dXJuIG51bGw7XG4gIGxlZnQgPSBsZWZ0LnN1YnN0cmluZyhzdGFydCk7XG5cbiAgY29uc3QgZW5kID0gZmluZFRhYmxlRW5kKGxlZnQpO1xuXG4gIGlmIChlbmQgPT09IC0xKSByZXR1cm4gbnVsbDtcbiAgbGVmdCA9IGxlZnQuc3Vic3RyaW5nKDAsIGVuZCk7XG5cbiAgY29uc3Qgcm93cyA9IGdldFJvd3MobGVmdCk7XG5cbiAgaWYgKCFyb3dzLmxlbmd0aCkgcmV0dXJuIG51bGw7XG5cbiAgY29uc3QgaGVhZGVycyA9IGdldEhlYWRlcnMocm93c1swXSk7XG5cbiAgaWYgKCFoZWFkZXJzLmxlbmd0aCkgcmV0dXJuIG51bGw7XG5cbiAgY29uc3QgZGF0YSA9IHJvd3NcbiAgICAuc2xpY2UoMSlcbiAgICAubWFwKHRyYW5zZm9ybUNlbGxzKVxuICAgIC5tYXAoKHJvdykgPT4ge1xuICAgICAgcmV0dXJuIGhlYWRlcnMucmVkdWNlKChvYmosIGtleSwgaW5kZXgpID0+IHtcbiAgICAgICAgb2JqW2NhbWVsY2FzZShmaWxsVmFyaWFibGUoa2V5LCBjb250ZXh0LCBvcHRpb25zKSldID0gZmlsbFZhcmlhYmxlcyhcbiAgICAgICAgICByb3dbaW5kZXhdLFxuICAgICAgICAgIGNvbnRleHQsXG4gICAgICAgICAgb3B0aW9uc1xuICAgICAgICApO1xuICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgfSwge30pO1xuICAgIH0pO1xuXG4gIHJldHVybiB7IGRhdGEsIGVuZDogc3RhcnQgKyBlbmQgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIChzb3VyY2UsIG9wdGlvbnMpIHtcbiAgY29uc3QgY2xlYW5lZFNvdXJjZSA9IGNsZWFuU291cmNlKHNvdXJjZSwgb3B0aW9ucyk7XG4gIGNvbnN0IGRhdGEgPSBleHRyYWN0RGF0YShjbGVhbmVkU291cmNlKTtcbiAgY29uc3QgdGFibGVzID0gW107XG4gIGxldCBsZWZ0ID0gZGF0YS5zb3VyY2U7XG4gIGxldCByZXN1bHQgPSBudWxsO1xuICB3aGlsZSAoKHJlc3VsdCA9IGdldE5leHRUYWJsZShsZWZ0LCBkYXRhLmNvbnRleHQsIG9wdGlvbnMpKSkge1xuICAgIGlmICghcmVzdWx0KSB7XG4gICAgICByZXR1cm4gdGFibGVzO1xuICAgIH1cbiAgICB0YWJsZXMucHVzaChyZXN1bHQuZGF0YSk7XG4gICAgbGVmdCA9IGxlZnQuc3Vic3RyaW5nKHJlc3VsdC5lbmQpO1xuICB9XG4gIHJldHVybiB0YWJsZXM7XG59XG4iLCJjb25zdCBsaW5rUGF0dGVybiA9IC9cXFtcXFsoW15cXF1dKylcXF1cXF0vZztcbmNvbnN0IGttUGF0dGVybiA9IC97e0JTa21cXHwoW1xcZHhdKyxbXFxkeF0rKVxcfChbXFxkeF0rLFtcXGR4XSspfX0vZztcblxuZnVuY3Rpb24gY2xlYW4odGV4dCkge1xuICByZXR1cm4gdGV4dFxuICAgIC5zdWJzdHJpbmcoMiwgdGV4dC5sZW5ndGggLSAyKVxuICAgIC5yZXBsYWNlKGxpbmtQYXR0ZXJuLCAobSwgeCkgPT4geC5zcGxpdCgnfCcpWzBdKVxuICAgIC5yZXBsYWNlKC8nJyc/L2csICcnKTtcbn1cblxuLy8gU291cmNlOiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9XaWtpcGVkaWE6Um91dGVfZGlhZ3JhbV90ZW1wbGF0ZSN7e0JTLW1hcH19X3Jvd3Nfd2l0aF9pY29uc19hbmRfdGV4dFxuZnVuY3Rpb24gcGFyc2VSb3cocmF3KSB7XG4gIGxldCBjb3VudE1hdGNoID0gcmF3WzBdLm1hdGNoKC9CUyhcXGQpLyk7XG4gIGxldCB0eXBlID0gcmF3WzBdLnN1YnN0cmluZygyKTtcbiAgbGV0IGNvdW50ID0gMTtcbiAgbGV0IGljb25zID0gW107XG4gIGxldCBpbmRleCA9IDE7XG4gIGlmIChjb3VudE1hdGNoKSB7XG4gICAgY291bnQgPSBjb3VudE1hdGNoWzFdO1xuICAgIHR5cGUgPSByYXdbMF0uc3Vic3RyaW5nKDMpO1xuICB9XG4gIGZvciAoOyBpbmRleCA8PSBjb3VudDsgaW5kZXgrKykge1xuICAgIGljb25zLnB1c2gocmF3W2luZGV4XSk7XG4gIH1cbiAgY29uc3QgbWFyZ2luID0gcmF3W2luZGV4KytdO1xuICBjb25zdCB0ZXh0MSA9IHJhd1tpbmRleCsrXTtcbiAgY29uc3QgdGV4dDIgPSByYXdbaW5kZXgrK107XG4gIGNvbnN0IGNvbW1lbnQgPSByYXdbaW5kZXgrK107XG4gIHJldHVybiB7XG4gICAgdHlwZSxcbiAgICBtYXJnaW4sXG4gICAgdGV4dDEsXG4gICAgdGV4dDIsXG4gICAgY29tbWVudCxcbiAgICBpY29ucyxcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKHNvdXJjZSkge1xuICBjb25zdCByZXN1bHRzID0gc291cmNlLnJlcGxhY2Uoa21QYXR0ZXJuLCAnJDEvJDInKS5tYXRjaCgve3tCUyhbXn19XSspfX0vZyk7XG4gIGlmIChyZXN1bHRzKSB7XG4gICAgcmV0dXJuIHJlc3VsdHNcbiAgICAgIC5tYXAoKHJlc3VsdCkgPT4gY2xlYW4ocmVzdWx0KS5zcGxpdCgnfCcpKVxuICAgICAgLm1hcChwYXJzZVJvdylcbiAgICAgIC5maWx0ZXIoKHsgdHlwZSB9KSA9PiB0eXBlWzBdICE9PSAnLScpO1xuICB9XG4gIHJldHVybiBudWxsO1xufVxuIiwiY29uc3QgaGVhZGluZ1BhdHRlcm4gPSAvW149XT09XFxzPyhbXFx3XFxzXSspXFxzPz09L2dcbmNvbnN0IHN1YmhlYWRpbmdQYXR0ZXJuID0gLz09PShbXFx3XFxzXSspPT09L2dcbmNvbnN0IHRhYmxlU3RhcnRQYXR0ZXJuID0gL3t7bGlzdC4rc3RhcnQuKn19L2dpXG5jb25zdCB0YWJsZUVuZFBhdHRlcm4gPSAve3tsaXN0LitlbmQuKn19L2dpXG5jb25zdCByb3dQYXR0ZXJuID0gL3t7KC4qKX19L2dcbmNvbnN0IHJvd1BhdHRlcm5TaW5nbGUgPSAve3soLiopfX0vXG5cbmZ1bmN0aW9uIGdldEhlYWRpbmdzKHRleHQpIHtcblx0bGV0IG1hdGNoO1xuXHRjb25zdCBoZWFkaW5ncyA9IFtdO1xuXHR3aGlsZSAoKG1hdGNoID0gaGVhZGluZ1BhdHRlcm4uZXhlYyh0ZXh0KSkgIT09IG51bGwpIHtcblx0XHRoZWFkaW5ncy5wdXNoKHtcblx0XHRcdGhlYWRpbmc6IG1hdGNoWzFdLnRyaW0oKSxcblx0XHRcdHN0YXJ0OiBtYXRjaC5pbmRleCxcblx0XHRcdGVuZDogbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGhcblx0XHR9KVxuXHR9XG5cdHJldHVybiBoZWFkaW5ncztcbn1cblxuZnVuY3Rpb24gZ2V0U3ViaGVhZGluZ3ModGV4dCkge1xuXHRsZXQgbWF0Y2g7XG5cdGNvbnN0IHN1YmhlYWRpbmdzID0gW107XG5cdHdoaWxlICgobWF0Y2ggPSBzdWJoZWFkaW5nUGF0dGVybi5leGVjKHRleHQpKSAhPT0gbnVsbCkge1xuXHRcdHN1YmhlYWRpbmdzLnB1c2goe1xuXHRcdFx0aGVhZGluZzogbWF0Y2hbMV0udHJpbSgpLFxuXHRcdFx0c3RhcnQ6IG1hdGNoLmluZGV4LFxuXHRcdFx0ZW5kOiBtYXRjaC5pbmRleCArIG1hdGNoWzBdLmxlbmd0aFxuXHRcdH0pXG5cdH1cblx0cmV0dXJuIHN1YmhlYWRpbmdzO1xufVxuXG5mdW5jdGlvbiBnZXRNYXRjaGVzKHRleHQsIHBhdHRlcm4pIHtcblx0bGV0IG1hdGNoO1xuXHRjb25zdCBtYXRjaGVzID0gW107XG5cdHdoaWxlICgobWF0Y2ggPSBwYXR0ZXJuLmV4ZWModGV4dCkpICE9PSBudWxsKSB7XG5cdFx0bWF0Y2hlcy5wdXNoKHtcblx0XHRcdHZhbHVlOiBtYXRjaFsxXSAmJiBtYXRjaFsxXS50cmltKCksXG5cdFx0XHRzdGFydDogbWF0Y2guaW5kZXgsXG5cdFx0XHRlbmQ6IG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoXG5cdFx0fSlcblx0fVxuXHRyZXR1cm4gbWF0Y2hlcztcbn1cblxuZnVuY3Rpb24gcGFyc2VUYWJsZURhdGEocmF3KSB7XG5cdGNvbnN0IG1hdGNoZXMgPSByYXcubWF0Y2gocm93UGF0dGVybik7XG5cdGlmICghbWF0Y2hlcykgcmV0dXJuIFtdO1xuXHRyZXR1cm4gbWF0Y2hlcy5tYXAoZWwgPT4ge1xuXHRcdGNvbnN0IFssdGV4dF0gPSBlbC5tYXRjaChyb3dQYXR0ZXJuU2luZ2xlKTtcblx0XHRjb25zdCBjb2x1bW5zID0gdGV4dC50cmltKCkuc3BsaXQoJ3wnKTtcblx0XHRyZXR1cm4gY29sdW1ucy5zbGljZSgxKTtcblx0fSk7XG59XG5cbmZ1bmN0aW9uIGdldFRhYmxlcyh0ZXh0KSB7XG5cdGNvbnN0IHRhYmxlU3RhcnRzID0gZ2V0TWF0Y2hlcyh0ZXh0LCB0YWJsZVN0YXJ0UGF0dGVybik7XG5cdGNvbnN0IHRhYmxlRW5kcyA9IGdldE1hdGNoZXModGV4dCwgdGFibGVFbmRQYXR0ZXJuKTtcblx0cmV0dXJuIHRhYmxlU3RhcnRzLm1hcCgodGFibGVTdGFydCwgaW5kZXgpID0+IHtcblx0XHRjb25zdCB0YWJsZUVuZCA9IHRhYmxlRW5kc1tpbmRleF07XG5cdFx0aWYgKCF0YWJsZUVuZCkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdbVGFibGUgUGFyc2luZ10gRmFpbGVkIHRvIHBhaXIgdGFibGUnKTtcblx0XHR9XG5cdFx0Y29uc3QgcmF3ID0gdGV4dFxuXHRcdFx0XHQuc3Vic3RyaW5nKHRhYmxlU3RhcnQuZW5kLCB0YWJsZUVuZC5zdGFydClcblx0XHRcdFx0LnRyaW0oKVxuXHRcdFx0XHQucmVwbGFjZSgvJycnL2csICcnKTtcblx0XHRyZXR1cm4ge1xuXHRcdFx0cm93czogcGFyc2VUYWJsZURhdGEocmF3KSxcblx0XHRcdHN0YXJ0OiB0YWJsZVN0YXJ0LnN0YXJ0LFxuXHRcdFx0ZW5kOiB0YWJsZUVuZC5lbmRcblx0XHR9XG5cdH0pO1xufVxu